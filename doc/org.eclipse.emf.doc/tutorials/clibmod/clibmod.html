<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Generating an EMF Model</title>
<link rel="stylesheet" href="images/../../../css/book.css" type="text/css" />
<link rel="stylesheet" href="images/../../../css/emf-book.css" type="text/css" />
</head>
<body lang="EN-US" xml:lang="EN-US">

<h1>Generating an EMF Model</h1>

<blockquote>

<b>Summary</b>

<p>This tutorial is a step-by-step description of the process of
creating an EMF model and generating a simple model editor for it.
Following this tutorial will show how easy EMF makes it to go from
a simple model definition to a fully functioning editor for that
model.</p>

<p>The screenshots are based on version <a target="_req" href="http://download2.eclipse.org/downloads/drops/S-3.0M9-200405211200/index.php">3.0M9 of the Eclipse SDK </a> and
version <a target="_req" href="http://download.eclipse.org/tools/emf/scripts/downloads-viewer.php?s=2.0/I200405200923">2.0.0 (build I200405200923) of the combined EMF, SDO, XSD SDKs</a>.</p>

<p>The model we will generate looks like this in UML (see the
<a href="../../references/overview/EMF.html">Eclipse Modeling Framework Overview</a> paper for a description of
this model):</p>

<p><img src="images/libuml.gif" alt="Library UML model"  /></p>

<p>We will show how an EMF model can be generated from either of
two different sources: a Rational Rose model or a set of annotated
Java interfaces and classes.</p>

<p>Last update: May 31, 2004.</p>
</blockquote>

<hr width="100%" />

<h2>Contents</h2>

<table border="0" cellspacing="2" cellpadding="2"
width="100%">
<tr>
<td valign="top" width="60">Step 0:</td>
<td valign="top"><a href="#step0">Prerequisites</a></td>
</tr>

<tr>
<td valign="top">Step 1:</td>
<td valign="top"><a href="#step1a">Import the Model from Rose</a>
or <a href="#step1b">Define the Model Using Annotated Java</a>
</td>
</tr>

<tr>
<td valign="top">Step 2:</td>
<td valign="top"><a href="#step2">Generate the EMF Model Code</a>
</td>
</tr>

<tr>
<td valign="top">Step 3:</td>
<td valign="top"><a href="#step3">Generate an Editor for the
Model</a> </td>
</tr>

<tr>
<td valign="top">Step 4:</td>
<td valign="top"><a href="#step4">Run the Generated Editor</a>
</td>
</tr>
</table>

<br />
<hr />
<p style="text-align: right"><a id="step0"
name="step0">&nbsp;</a><a href="#top">contents</a></p>

<h2>Step 0: Prerequisites</h2>

<p>The EMF Runtime package includes the EMF generator and a number
of related plugins. After installing the package, verify that they
are available in your Eclipse environment:</p>

<ul>
<li>Bring up the "Help/About Eclipse Platform" dialog.<br />
 <img src="images/img001.gif" alt="Help/About Eclipse Platform"/><br />
&nbsp;</li>

<li>Click on "Plug-in Details".<br />
 <img src="images/img002.gif" alt="Plug-in Details"/><br />
&nbsp;</li>

<li>Check that the set of plugins (highlighted in blue) are present. If you also installed SDO, you will have the plugins highlighted in green. XSD plugins are highlighted in pink.<br />
 <img src="images/img003.gif" alt="Check EMF plugins"/><br />
&nbsp;</li>
</ul>

<hr />
<p style="text-align: right"><a id="step1a"
name="step1a">&nbsp;</a><a href="#top">contents</a></p>

<h2>Step 1a: Import the Model from Rose</h2>

<p>The Rose file for the library model can be found here: <a target="_code" 
href="images/../library.mdl">library.mdl</a>. Save it
somewhere on your workstation.</p>

<h3>Create a new Ecore model project in the workspace:</h3>

<ul>
<li>Bring up the "File/New/Project..." dialog (by hitting CTRL-N or one of the following two ways:<br />
 <img src="images/img004.gif" alt="File/New/Project..."/> or 
 <img src="images/img004b.gif" alt="File/New/Project..."/>
 <br />
&nbsp;</li>

<li>Select "Eclipse Modeling Framework" and "EMF Project". Click
the "Next" button.<br />
 <img src="images/img005.gif" alt="EMF Project" /><br />
&nbsp;</li>

<li>Give the project a name, say, "library". Then, click the "Next"
button.<br />
 <img src="images/img006.gif" alt="Name the project"/><br />
&nbsp;</li>

<li>Select "Load from a Rose class model" and click the "Next"
button.<br />
 <img src="images/img007.gif" alt="Load from a Rose class model"/><br />
&nbsp;</li>

<li>Click on the "Browse" button and locate the Rose model
file. The Rose model file will be examined, and a default GenModel
name will be suggested. You can change the name in the entry box if
you wish. <br/>
 <img src="images/img008.gif" alt="Loading model"/><br />
&nbsp;</li>

<li>Then click the "Next" button.<br />
 <img src="images/img009.gif" alt="Creating packages"/><br />
&nbsp;</li>

<li>In general, a Rose model may contain more than one package.
Select the package for which you want to generate an EMF model --
in this case, the only package, "library". Click the "Finish"
button.<br />
 <img src="images/img010.gif" alt="Select package"/><br />
&nbsp;</li>

<li>An Ecore model and a GenModel will be created. The GenModel,
which controls code generation for the model, is opened in the main
view (initally collapsed, this is how it looks fully expanded).<br />
 <img src="images/img011.gif" alt="Opened GenModel"/><br />
&nbsp;</li>
<li>The Ecore model looks like this when fully expanded:<br />
 <img src="images/img011b.gif" alt="Opened Ecore model"/><br />
&nbsp;</li>
</ul>

<hr />
<p style="text-align: right"><a id="step1b"
name="step1b">&nbsp;</a><a href="#top">contents</a></p>

<h2>Step 1b: Define the Model Using Annotated Java</h2>

<p>Instead of importing the model from a Rose diagram, we can start
with a set of Java interfaces and classes that correspond to the
classes and enumerated types, respectively, in the library model.
This code is the bare minimum required to illustrate the desired
features. Based on it, an Ecore model and a GenModel will be
constructed, which will then drive generation of the remaining
code. The code is annotated with "@model" tags in Javadoc comments,
in order to specify any non-default values for the attributes and
references of the Ecore objects.</p>

<blockquote><b><a target="_code"
href="images/../Library.java">Library.java</a></b><a name="Library.java">&nbsp;</a><br />


<table border="1" frame="box">
<tr>
<td>
<pre>package org.eclipse.example.library;
import java.util.List;
/**
 * @model
 */
public interface Library
{
  /**
   * @model type="Book" containment="true"
   */
  List getBooks();
  /**
   * @model type="Writer" containment="true"
   */
  List getWriters();
  /**
   * @model
   */
  String getName();
}
</pre>
</td>
</tr>
</table>
</blockquote>

<blockquote><b><a target="_code"
href="images/../Book.java">Book.java</a></b><a name="Book.java">&nbsp;</a><br />
 

<table border="1" frame="box">
<tr>
<td><pre>package org.eclipse.example.library;
/**
 * @model
 */
public interface Book
{
  /**
   * @model
   */
  String getTitle();
  /**
   * @model default="100"
   */
  int getPages();
  /**
   * @model opposite="books"
   */
  Writer getAuthor();
  /**
   * @model
   */
  BookCategory getCategory();
}</pre>
</td>
</tr>
</table>
</blockquote>

<blockquote><b><a target="_code"
href="images/../Writer.java">Writer.java</a></b><a name="Writer.java">&nbsp;</a><br />
 

<table border="1" frame="box">
<tr>
<td><pre>package org.eclipse.example.library;
/**
 * @model
 */
public interface Writer
{
  /**
   * @model
   */
  String getName();
  /**
   * @model type="Book" opposite="author"
   */
  java.util.List getBooks();
}</pre>
</td>
</tr>
</table>
</blockquote>

<blockquote><b><a target="_code"
href="images/../BookCategory.java">BookCategory.java</a></b><a name="BookCategory.java">&nbsp;</a><br />
 

<table border="1" frame="box">
<tr>
<td><pre>package org.eclipse.example.library;
/**
 * @model
 */
public class BookCategory
{
  /**
   * @model name="Mystery"
   */
  public static final int MYSTERY = 0;
  /**
   * @model name="ScienceFiction"
   */
  public static final int SCIENCE_FICTION = 1;
  /**
   * @model name="Biography"
   */
  public static final int BIOGRAPHY = 2;
}</pre>
</td>
</tr>
</table>
</blockquote>

<h3>Create a new Java project in the workspace:</h3>


<ul>
<li>Bring up the "File/New/Project..." dialog (by hitting CTRL-N or one of the following two ways:<br />
 <img src="images/img004.gif" alt="File/New/Project..."/> or 
 <img src="images/img004b.gif" alt="File/New/Project..."/>
 <br />
&nbsp;</li>

<li>Select "Java" and "Java Project". Click the "Next"
button.<br />
 <img src="images/img012.gif" alt="Java Project"/><br />
&nbsp;</li>

<li>Give the project a name, say, "library2". Make sure you check the radio button for "Create separate source and output folders". By default, this creates a src/ and a bin/ folder within your project folder. Then, click the "Next"
button.<br />
 <img src="images/img013.gif" alt="Name the project"/><br />
&nbsp;</li>

<li>Specify "library/runtime" as the build default output folder.
Click the "Finish" button.<br />
 <img src="images/img014.gif" alt="Specify build output folder"/><br />
&nbsp;</li>

<li>The newly created Java project can be seen in the Package
Explorer.<br />
 <img src="images/img015.gif" alt="Library Java project"/><br />
&nbsp;</li>
</ul>

<h3>Create the first Java interface:</h3>


<ul>
<li>Right-click the "src" folder and select "New/Interface" from
the pop-up menu.<br />
 <img src="images/img016.gif" alt="New/Interface"/><br />
&nbsp;</li>

<li>Fill in the package and interface name. Click the "Finish"
button.<br />
 <img src="images/img017.gif" alt="Create new interface"/><br />
&nbsp;</li>

<li>A new Java interface file is created and opened in the main
view.<br />
 <img src="images/img018.gif" alt="Opened interface"/><br />
&nbsp;</li>

<li>Type (or paste) in the interface code, as <a href="#Library.java">shown above</a>. Pay special attention to the "@model" tags. Right-click code and select "Save", or select "Save" from the "File" menu. Or, you can use CTRL-X-S to save.<br />
 <img src="images/img019.gif" alt="Enter interface code"/><br />
&nbsp;</li>

<li>Repeat the above steps for creating the other two interfaces, <a href="#Book.java">Book.java</a> and <a href="#Writer.java">Writer.java</a>, and the <a href="#BookCategory.java">BookCategory.java</a> class in the same way.
Of course, to create the class, select "New/Class" from the pop-up
menu, instead of "New/Interface". You can use CTRL-X, S to Save All open edited documents. 
<br/>
<img src="images/img020.gif" alt="New/Class" />
<br/>
&nbsp;
</li>

<li>Note also that if you right-click the package under the src folder, the wizard will prefill with that value so you don't need to enter it manually - only the Interface or Class name.
<br/>
<img src="images/img020b.gif" alt="New/Class - package prefilled" />
<br/>
&nbsp;</li>

<li>When done, you should have this:
<br/>
<img src="images/img021.gif" alt="Package contents" />
<br/>
&nbsp;</li>
</ul>

<h3>Create the GenModel:</h3>


<ul>
<li>In the Package Explorer view, right-click the "src" folder and
select "New/Other..." from the pop-up menu (or just hit CTRL-N). Select "Eclipse Modeling Framework" and "EMF Models". Click the
"Next" button.<br />
 <img src="images/img022.gif" alt="New/Other..."/><br />
&nbsp;</li>

<li>Change the folder to "library/src/model", and the file name to "library.genmodel" and click the "Next"
button.<br />
 <img src="images/img023.gif" alt="Change the folder and file name"/><br />
&nbsp;</li>

<li>Select "Load from Java annotations" and click the "Next"
button.<br />
 <img src="images/img024.gif" alt="Load from Java annotations"/><br />
&nbsp;</li>

<li>Select library package and click the "Finish" button.<br />
 <img src="images/img025.gif" alt="Check library"/><br />
&nbsp;</li>

<li>An Ecore model and a GenModel will be created. The GenModel,
which controls code generation for the model, is opened in the main
view.<br />
 <img src="images/img026.gif" alt="Opened GenModel"/><br />
&nbsp;</li>
</ul>

<hr />
<p style="text-align: right"><a id="step2"
name="step2">&nbsp;</a><a href="#top">contents</a></p>

<h2>Step 2: Generate the EMF Model Code</h2>

<p>The GenModel shows a root object, representing the the whole
model. The model object has children that represent its packages,
whose children then represent classifiers (classes and datatypes,
including enumerated types). The children of classes are class
attributes, references, and operations; the children of enumerated
types are enum literals.</p>

<ul>
<li>The GenModel can be expanded to see its various elements.<br />
 <img src="images/img011.gif" alt="Expanded GenModel"/><br />
&nbsp;</li>
<a name="showpropertiesview">&nbsp;</a>
<li>There are properties associated with each object. If the
Properties view isn't already showing, right-click and select "Show Properties View", or bring up "Window/Show
View/Other..." <br />
 <img src="images/img027.gif" alt="Show Properties View" /> or 
 <img src="images/img027b.gif" alt="Window/Show View/Other..." /><br />
&nbsp;</li>

<li>Expand the "Basic" set of views and choose "Properties".<br />
 <img src="images/img028.gif" alt="Chose Properties"/><br />
&nbsp;</li>

<li>These properties control the behavior of the code
generator.<br />
 <img src="images/img029.gif" alt="GenModel properties - tree view"/><br />
&nbsp;</li>

<li>Depending on preference, you can show them in diffent ways (tree or flat).<br />
 <img src="images/img029b.gif" alt="GenModel properties - flat view"/><br />
&nbsp;</li>
</ul>

<p>In most cases, the properties need not be changed from their
default values, but these options can provide a great deal of
control over the code that gets generated. This topic will be
explored more fully in future tutorial material; for now, select
several different GenModel objects, and observe their
properties.</p>

<p>The GenModel is also the place where you initiate the code
generation. By right-clicking on an object in the model, you can
generate code for it.</p>

<ul>
<li>Right-click the "library" model object and select "Generate
Model Code" from the pop-up menu. Observe the generated files.<br />
 <img src="images/img030.gif" alt="Generated model code"/><br />
<br />
</li>
</ul>

<p>After generation, the class interfaces and enum class will have
been created (if the model was imported from Rose) or completed (if
the model was defined using annotated Java), and a new pair of
interfaces will have been created for the package itself and for
the factory. There will also be two new packages, with "impl" and
"util" suffixes, which contain implementations of the interfaces
and additional utility classes, and a "plugin.xml" manifest file
for the model plugin.</p>

<p>If you define the model by using annotated Java, after
generating code by selecting "Generate Model Code" pop-up menu, you
may see the warning message "The import java.util.List is never
used". This message is ok for you to continue to work on next
step (this warning used to appear in EMF 1.1 with Eclipse 2.1).</p>

<p>If you change the model, you can regenerate it, and changes will
be merged with any hand modifications that may have been made to
the code. You can also selectively generate a subset of the model
code by right-clicking on a package, class, or enum object and
selecting "Generate Model Code" from the pop-up menu.</p>

<hr />
<p style="text-align: right"><a id="step3"
name="step3">&nbsp;</a><a href="#top">contents</a></p>

<h2>Step 3: Generate an Editor for the Model</h2>

<p>A fully functional Eclipse editor can also be generated for any
model. By default, it is split between two plugins: an "edit"
plugin includes adapters that provide a structured view and perform
command-based editing of the model objects; an "editor" plugin
provides the UI for the editor and wizard.</p>

<ul>
<li>In the GenModel, right-click the "Library" model object and
select "Generate Edit Code" from the pop-up menu, then repeat for "Generate Editor Code". Alternatively, you can also select "Generate All" to generate the model (again), edit, and editor code.<br />
 <img src="images/img031.gif" alt="Generate Edit Code"/><br />
&nbsp;</li>

<li>Observe the generated projects, with "edit" and "editor"
suffixes. (In this workspace screenshot, library.* projects were based on importing a Rose model (<a href="#step1a">Step 1a</a>), and library2.* projects were based on annotated java (<a href="#step1b">Step 1b</a>), above.)<br />
 <img src="images/img032.gif" alt="Edit and editor projects"/><br />
&nbsp;</li>
</ul>

<p>In general, if you wish to generate the model, edit, and editor
plugins in a single step, you can do so by selecting "Generate All"
from the pop-up menu.</p>

<p>The code should be compiled automatically as it is generated,
and should recompile whenever it is changed. If you have disabled
automatic building in the workbench preferences, you can initiate
compilation manually:</p>

<ul>
<li>Select "Rebuild All" from the "Project" menu.<br />
 <img src="images/img033.gif" alt="Project/Rebuild All"/><br />
&nbsp;</li>

<li>There should no errors in the "library", "library.edit", and
"library.editor" projects if you import the model from Rose. <br />
 <img src="images/img034.gif" alt="No errors"/><br />
&nbsp;</li>

<li>There should be one warning message your projects if you define the model using
Annotated Java.<br />
 <img src="images/img034_error.gif" alt="One warning"/><br />
&nbsp;</li>

<li>This is due to the fact that the generated code will add <tt>import org.eclipse.emf.common.util.EList;</tt> into your imports, but will NOT remove the unused <tt>import java.util.List;</tt>. You will also notice that the return type of the generated code is EList, not List. To remove this warning, simply select "Organize Imports" from the "Source" menu, or hit CTRL-SHIFT-O. You can also right-click a package or file and "Orgainise Imports" on that file (or group of files).<br />
 <img src="images/img034_error2.gif" alt="One warning - how to fix"/><br />
&nbsp;</li>
</ul>

<hr />
<p style="text-align: right"><a id="step4"
name="step4">&nbsp;</a><a href="#top">contents</a></p>

<h2>Step 4: Run the Generated Editor</h2>

<p>In order to run plugins in a runtime workbench, a lunch
configuration must first be set up:</p>

<ul>
<li>Select "Run..." from the "Run" menu.<br />
 <img src="images/img035.gif" alt="Run/Run..."/><br />
&nbsp;</li>

<li>Select "Run-time Workbench" and click the "New" button. You can name your new configuration something meaningful. <br />
 <img src="images/img036.gif" alt="New Run-time Workbench"/><br />
&nbsp;</li>

<li> Then, switch to the "Plug-ins"
tab. Pick "Choose plugin-ins and fragments to launch from the list",
and then select the top-level "External Plug-ins".<br />
 <img src="images/img037.gif" alt="Select all External Plugins"/><br />
&nbsp;</li>

<li>Switch to the "Common" tab, select "Display in favorites menu:
Run". You may want to change the configuration's name to something
more recognizable. Click the "Apply" button.<br />
 <img src="images/img038.gif" alt="Display in favorites menu: Run"/><br />
&nbsp;</li>
</ul>

<p>A runtime workbench can be launched from the "Launch
Configurations" dialog by clicking on the "Run" button. Once the
launch configuration has been set up, it can also be launched from
the "Run" button on the toolbar.</p>

<ul>
<li>Select the new launch configuration from the "Run" button
drop-down.<br />
 <img src="images/img039.gif" alt="Library Configuration - Run button"
 /> or <img src="images/img039b.gif" alt="Library Configuration - Run menu"/><br />
&nbsp;</li>

<li>Wait for a second instance of the Eclipse platform to come up.
Bring up the "Help/About Eclipse Platform" dialog, click on the
"Plug-in Details" button, and verify that the generated plugins are
there.<br />
 <img src="images/img040.gif" alt="Plug-in Details"/><br />
&nbsp;</li>
</ul>

<p>The library model wizard can now be used to create a new
instance of the model.</p>

<ul>
<li>Bring up the "File/New/Project..." dialog.<br />
 <img src="images/img041.gif" alt="File/New/Project..."/><br />
&nbsp;</li>

<li>Select "Simple" and "Project". Click the "Next" button.<br />
 <img src="images/img042.gif" alt="Simple Project"/><br />
&nbsp;</li>

<li>Give the project a name and click the "Finish" button.<br />
 <img src="images/img043.gif" alt="Name the project"/><br />
&nbsp;</li>

<li>Right-click the project and select "New/Other..." from the
pop-up menu (or CTRL-N). Select "Example EMF Model Creation Wizards" and "Library
Model" (Rose model import, from <a href="#step1a">Step 1a</a>) or "Library2 Model" (annotated java, from <a href="#step1b">Step 1b</a>). Click the "Next" button.<br />
 <img src="images/img044.gif" alt="Library Model"/><br />
&nbsp;</li>

<li>Enter a file name for the library model. Make sure it ends with
a ".library" extension. Then click the "Next" button.<br />
 <img src="images/img045.gif" alt="Name the library model file"/><br />
&nbsp;</li>

<li>Select "Library" as the model object, and your preferred XML encoding (UTF-8 is the default). Click the "Finish"
button.<br />
 <img src="images/img046.gif" alt="Select the Model Object"/><br />
&nbsp;</li>

<li>The newly created library model is opened in the main
view. (To display the Properties view, right-click in the main view and select "<a href="#showpropertiesview">Show Properties View</a>.")<br />
 <img src="images/img047.gif" alt="New library model"/><br />
&nbsp;</li>
</ul>

<p>The root object in this editor corresponds to the "My.library"
resource. Under it lies a single library, the object which was
selected as the model object in the wizard.</p>

<ul>
<li>Expand the "platform:/resource/librarytest/My.library" resource
to see the library object. Select it (see above image). In the Properties view, click on the "Value" column of the
"Name" property, and give a name to the library. The label in the
main view will be updated when you hit Enter.<br />
 <img src="images/img048.gif" alt="Name the library"/><br />
&nbsp;</li>

<li>Right-click on the library and select "New Child/Writer" from
the pop-up menu to add a new writer to the library.<br />
 <img src="images/img049.gif" alt="New Child/Writer"/><br />
&nbsp;</li>

<li>Enter the name of the writer in the Properties view.<br />
 <img src="images/img050.gif" alt="Name the writer"/><br />
&nbsp;</li>

<li>Similarly, a book can be added to the library.<br />
 <img src="images/img051.gif" alt="New Child/Book"/><br />
&nbsp;</li>

<li>All the book's attributes and references can edited in the
Properties view.<br />
 <img src="images/img052.gif" alt="Book properties"/><br />
&nbsp;</li>

<li>You can save, close, and then re-open the model using the text
editor if you wish to see the saved model in XMI format.<br />
 <img src="images/img053.gif" alt="Open With/Text Editor"/><br />
&nbsp;</li>

<li>The XMI format of the ".library" file contains a Library object
called "Skillz Center", a Book object with the value of title as
"Fellowship of the Ring", and a Writer object with "JRR Tolkien"
as the writer's name. (Line breaks added for formatting purposes.)<br />
<pre class="code">
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;org.eclipse.example.library:Library 
	xmlns:org.eclipse.example.library="http:///org/eclipse/example/library.ecore" 
	name="Skillz Center">
  &lt;books 
  	title="Fellowship Of The Ring" 
  	pages="324" author="#//@writers.0" 
  	category="ScienceFiction"/>
  &lt;writers 
  	name="JRR Tolkien" 
  	books="#//@books.0"/>
&lt;/org.eclipse.example.library:Library>
</pre>
<br />
&nbsp;</li>
</ul>

<hr />
<p style="text-align: right"><a href="#top">contents</a></p>
</body>
</html>

